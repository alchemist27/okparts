카페24 공급사용 모바일 앱(PRD)
1) 배경/목표

목표: 카페24 쇼핑몰의 대표운영자가 1회 OAuth 설치·승인 후, **공급사(입점사)**가 별도의 카페24 관리자 화면 없이 모바일 전용 웹 UI(PWA)에서 회원가입·로그인 → 상품 등록(대표/리스트용 이미지 중심)까지 자가 처리.

핵심 가치:

현장(매장/창고)에서 스마트폰 카메라·앨범으로 즉시 등록

간소화된 입력(필수 항목 최소화)과 가이드형 폼

안정적 업로드(리사이즈/압축, 재시도, 오프라인 큐)

운영자 승인 옵션(몰 정책에 따라 승인형/즉시형 선택)

2) 범위(Scope)
In

공급사 자체 회원가입/로그인(앱 내부 계정) 및 권한 매핑

상품 등록/수정(기본 정보, 가격, 재고, 카테고리 매핑)

이미지: 대표/리스트(썸네일) 중심 업로드(상세 이미지는 생략)

모바일 사진 촬영/앨범 선택 → 클라이언트 1차 리사이즈/압축 → 서버 업로드 → 카페24 Admin API 반영

승인 워크플로(선택): 등록 후 운영자 승인 모드 지원

PWA: 홈화면 추가, 오프라인 큐(간단), 재시도

Out (이번 버전 제외)

동영상 업로드/임베드 (요청에 따라 배제)

복잡한 옵션 트리/세트상품/사은품/행사 등 고급 프로모션

멀티몰 통합 운영 콘솔(추후)

3) 사용자/권한 모델

대표운영자(스토어 오너)

역할: 앱 설치·OAuth 승인(최초 1회), 승인형 모드 시 최종 승인

공급사(입점사) 사용자

역할: 앱(웹 UI)에서 회원가입/로그인 → 제품 등록/수정

접근: 앱 내부 권한으로 제한(자기 상품만 CRUD)

시스템(서버)

역할: 카페24 Admin API 프록시(액세스 토큰 보관/갱신)

4) 핵심 사용자 스토리(US)

US-01 | 대표운영자 앱 설치
스토어 오너로서 카페24에 앱을 설치·승인해 내 몰 데이터 접근 권한을 위임하고 싶다.

US-02 | 공급사 회원가입
공급사로서 모바일에서 계정을 만들고 즉시 등록을 시작하고 싶다.

US-03 | 상품 빠른 등록
이름/가격/카테고리/판매상태/재고 최소값만으로 제품을 빠르게 올리고 싶다.

US-04 | 이미지 업로드(모바일)
촬영/앨범에서 사진을 선택하면 자동으로 용량을 줄여 업로드하고 대표·리스트 이미지로 반영되길 원한다.

US-05 | 승인 모드(옵션)
우리 몰은 공급사 상품을 승인가이드에 따라 검수 후 노출하고 싶다.

US-06 | 이력/상태 확인
내가 올린 상품의 상태(임시저장/검수중/승인/반려)를 모바일에서 즉시 보고 싶다.

5) 플로우(요약)
5.1 설치 & 권한

대표운영자: 카페24에서 앱 설치·OAuth 승인(최초 1회)

서버: access_token/refresh_token 안전 저장, 자동 갱신 루틴 활성화

5.2 공급사 온보딩

공급사: 웹 URL 접속(PWA 권장) → 회원가입(회사명/담당자/이메일/휴대폰/비밀번호)

서버: 내부 DB 생성 → (정책에 따라) 카페24 공급사 엔티티 자동 등록

매핑 저장: app_supplier_id ↔ cafe24_supplier_no

5.3 상품 등록

공급사: “새 상품” → 필수 필드 입력(상품명, 판매가, 간단 설명, 카테고리, 판매상태, 재고수량)

이미지: <input type="file" accept="image/*" capture>로 촬영/선택 → 클라이언트 1차 리사이즈/압축 → 서버 업로드

서버: 원본 정규화(회전/EXIF 제거), 필요 시 썸네일 생성 → 카페24 Admin API로 이미지/상품 반영

승인 모드: 승인 필요 시 상태 pending → 운영자 승인 후 active 노출

6) 화면 및 UX 요구사항(모바일 퍼스트)

로그인/회원가입: 최소 필드, SMS/이메일 검증(옵션)

대시보드: “상품 등록” CTA, 최근 등록 목록, 승인 상태 배지

상품 폼:

필수: 상품명, 판매가, 판매상태(판매/품절/숨김), 카테고리, 재고수량

선택: 간단 설명, 브랜드/모델(있다면)

이미지 업로드 영역: 대표 1장(필수) + 추가 대표 2~4장(선택)

업로드 전 미리보기, 회전, 자르기(간단)

이미지 처리: 진행률/실패 재시도 버튼, 업로드 제한 안내(예: 5MB/장 목표)

오류 안내: 카페24 API 에러코드 매핑 메시지(429, 4xx 유효성, 5xx 재시도)

PWA: 홈화면 추가 배너, 오프라인 큐(간단), 재접속 시 자동 업로드 재개

7) 기술 아키텍처
7.1 클라이언트(웹/PWA)

Stack: Next.js(또는 Remix) + TypeScript

카메라/앨범: <input type="file" accept="image/*" capture="environment">

이미지 전처리: Canvas/Web Worker로 1600~2048px, JPEG/WebP, Q=0.8~0.9

PWA: manifest.json, Service Worker(업로드 재시도 큐)

7.2 서버(BFF / API 프록시)

Stack: Next.js API Routes / Node Koa/Express + TypeScript

Auth: 공급사 자체 계정(Firebase Auth or 자체 JWT)

카페24 OAuth 토큰 보관 & 자동 갱신(서버만)

이미지 정규화: sharp로 회전/메타 제거/크기 표준화

스토리지: Firebase Storage / S3 (임시 저장 후 카페24 반영 또는 바로 반영)

7.3 카페24 연동(관리자 API)

토큰 소유자: 대표운영자(몰 단위, 최초 1회 승인)

주요 동기 엔드포인트(개념):

공급사 생성/조회(정책 선택 시)

상품 생성/수정/조회

상품 이미지 업로드/매핑

카테고리 조회/매핑

(옵션) 상품 승인/반려

Rate limit 대응: 큐/백오프, 헤더 기반 모니터링

7.4 데이터 모델(예시: Firestore)

suppliers

id(app), email, companyName, phone, status(active/pending/blocked)

cafe24SupplierNo, createdAt

products

id(app), supplierId, cafe24ProductNo

name, price, status(draft/pending/active/rejected)

stockQty, categoryIds[], images: {cover, gallery[]}, createdAt, updatedAt

installs

mallId, accessToken, refreshToken, scopes[], installedAt, expiresAt

8) 이미지 정책

클라이언트 1차 축소: 최대 변 1600~2048px, JPEG/WebP Q0.85

서버 정규화:

대표: 1600px JPEG Q0.88

썸네일: 320px WebP Q0.8

상세이미지 미사용: 대표/리스트(썸네일) 중심

EXIF 제거 & 회전 보정: 필수

용량 가드: 1장 ≤ 2MB(권장), 1회 업로드 총합 ≤ 10~30MB 가드

9) 보안/권한

카페24 토큰은 서버 전용(클라이언트 직호출 금지)

공급사별 데이터 분리(서버에서 supplierId 스코프 체크)

업로드 파일 MIME/크기 검증, 악성 확장자 차단

HTTPS 필수, CSP/CSRF 적용

10) 장애/안정성

429(레이트리밋): 지수 백오프, 큐잉(작업 재시도)

5xx 장애: 재시도 + 운영자 알림(Slack/Webhook)

업로드 실패 시 로컬 큐에 보관(PWA) → 연결 복구 시 재전송

감사 로그: 주요 API 요청/응답 요약, 에러 스택 저장

11) 설정/운영 옵션

승인 모드: On(검수 후 노출) / Off(즉시 노출)

카테고리 정책: 허용 카테고리 화이트리스트

가격/재고 정책: 최소/최대 범위, 기본값 자동 채움

이미지 정책: 허용 확장자, 최대 장수, 권장 해상도

12) 관리 백오피스(간단)

공급사 목록(검색/차단/해제)

상품 목록(공급사 필터, 상태 배치 승인/반려)

오류 대시보드(최근 24시간 실패 작업, 재시도 버튼)

13) API 설계(앱 서버, 예시)

POST /api/supplier/signup → 내부 계정 생성 → (옵션) 카페24 공급사 자동 등록

POST /api/auth/login → JWT 발급

GET /api/categories → 카테고리 캐시 리턴

POST /api/products → 상품 생성(draft)

POST /api/products/:id/images → 이미지 업로드(대표/추가) → 카페24 반영

PUT /api/products/:id/publish → 승인모드에 따라 승인 요청/즉시 활성화

GET /api/products?mine=1 → 내 상품 목록

GET /api/products/:id / PUT /api/products/:id

서버 내부에서 카페24 Admin API를 호출(프록시).
토큰 자동갱신 미들웨어 공통 적용.

14) 수락 기준(Acceptance Criteria)

 대표운영자 1회 설치 후, 공급사 신규 가입이 운영자 개입 없이 완료된다(정책이 승인 모드 Off일 때).

 공급사는 모바일에서 3분 이내에 상품 1건을 등록할 수 있다(필수값+대표 이미지 1장 기준).

 이미지 업로드 실패 시 재시도가 가능하고, 오프라인 상태에서도 큐에 저장 후 온라인 시 자동 전송된다.

 승인 모드 On일 때, 상품 상태가 pending → approved/rejected로 정상 전환되며 목록에 반영된다.

 공급사는 자기 상품만 조회/수정 가능하다.

 429/5xx 발생 시 백오프/재시도 로직이 동작하고 운영자 대시보드에 에러가 보인다.

15) 일정/마일스톤(예시, 4주)

W1: 환경세팅, 카페24 설치/OAuth, 토큰 자동갱신, 데이터 모델

W2: 공급사 가입/로그인, 카테고리 캐시, 상품 생성/조회

W3: 이미지 파이프라인(전/후처리), 업로드 안정화(PWA 큐), 승인 모드

W4: 관리자 백오피스(경량), QA/부하/에러핸들링, 보안 점검, 문서화

16) 테스트 전략

단위: 이미지 리사이즈 함수, 토큰 리프레시, 권한가드

통합: 상품 생성→이미지 업로드→승인/노출 플로우

E2E: 모바일 실기(안드로이드/아이폰) 촬영/업로드/재시도

부하: 100개 이미지 연속 업로드 시 429 없이 큐잉되는지

17) 리스크 & 완화

모바일 대용량 원본 → 클라 1차 축소 강제, 서버 상한 체크

레이트리밋 → 큐/백오프, 작업 스케줄러

권한 누출 위험 → 전면 서버 프록시, 세분화된 소유권 체크

현장 네트워크 불안정 → PWA 오프라인 큐, 재시도

18) 운영/모니터링

로그/메트릭: 요청량, 실패율, 평균 업로드 시간, 승인 대기 건수

알림: 오류 임계치 초과 시 Slack/Webhook

백업: 토큰/설정 스냅샷, 일일 백업